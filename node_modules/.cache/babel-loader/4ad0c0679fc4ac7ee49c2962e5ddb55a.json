{"ast":null,"code":"const cart = require('./cart');\n\nconst fs = require('fs');\n\nconst actions = {\n  add: cart.add,\n  change: cart.change,\n  del: cart.del\n}; //HANDLER отвечает за изменение данных в самом файле\n\nlet handler = (req, res, action, file) => {\n  fs.readFile(file, 'utf-8', (err, data) => {\n    if (err) {\n      res.sendStatus(404, JSON.stringify({\n        result: 0,\n        text: err\n      }));\n    } else {\n      let newCart = actions[action](JSON.parse(data), req);\n      fs.writeFile(file, newCart, err => {\n        if (err) {\n          res.sendStatus(404, JSON.stringify({\n            result: 0,\n            text: err\n          }));\n        } else {\n          res.send(JSON.stringify({\n            result: 1\n          }));\n        }\n      });\n    }\n  });\n};\n\nmodule.exports = handler;","map":{"version":3,"names":["cart","require","fs","actions","add","change","del","handler","req","res","action","file","readFile","err","data","sendStatus","JSON","stringify","result","text","newCart","parse","writeFile","send","module","exports"],"sources":["/Users/denis/gb_online_store/src/server/handler.js"],"sourcesContent":["const cart = require('./cart');\nconst fs = require('fs');\n\nconst actions = {\n    add: cart.add,\n    change: cart.change,\n    del: cart.del\n};\n\n//HANDLER отвечает за изменение данных в самом файле\nlet handler = (req, res, action, file) => {\n    fs.readFile(file, 'utf-8', (err, data)=> {\n        if(err){\n            res.sendStatus(404, JSON.stringify({result:0, text: err}));\n        } else {\n            let newCart = actions[action](JSON.parse(data), req);\n            fs.writeFile(file, newCart, (err) => {\n                if(err){\n                    res.sendStatus(404, JSON.stringify({result:0, text: err}));\n                } else {\n                    res.send(JSON.stringify({result: 1}))\n                }\n            })\n        }\n    })\n};\n\nmodule.exports = handler;"],"mappings":"AAAA,MAAMA,IAAI,GAAGC,OAAO,CAAC,QAAD,CAApB;;AACA,MAAMC,EAAE,GAAGD,OAAO,CAAC,IAAD,CAAlB;;AAEA,MAAME,OAAO,GAAG;EACZC,GAAG,EAAEJ,IAAI,CAACI,GADE;EAEZC,MAAM,EAAEL,IAAI,CAACK,MAFD;EAGZC,GAAG,EAAEN,IAAI,CAACM;AAHE,CAAhB,C,CAMA;;AACA,IAAIC,OAAO,GAAG,CAACC,GAAD,EAAMC,GAAN,EAAWC,MAAX,EAAmBC,IAAnB,KAA4B;EACtCT,EAAE,CAACU,QAAH,CAAYD,IAAZ,EAAkB,OAAlB,EAA2B,CAACE,GAAD,EAAMC,IAAN,KAAc;IACrC,IAAGD,GAAH,EAAO;MACHJ,GAAG,CAACM,UAAJ,CAAe,GAAf,EAAoBC,IAAI,CAACC,SAAL,CAAe;QAACC,MAAM,EAAC,CAAR;QAAWC,IAAI,EAAEN;MAAjB,CAAf,CAApB;IACH,CAFD,MAEO;MACH,IAAIO,OAAO,GAAGjB,OAAO,CAACO,MAAD,CAAP,CAAgBM,IAAI,CAACK,KAAL,CAAWP,IAAX,CAAhB,EAAkCN,GAAlC,CAAd;MACAN,EAAE,CAACoB,SAAH,CAAaX,IAAb,EAAmBS,OAAnB,EAA6BP,GAAD,IAAS;QACjC,IAAGA,GAAH,EAAO;UACHJ,GAAG,CAACM,UAAJ,CAAe,GAAf,EAAoBC,IAAI,CAACC,SAAL,CAAe;YAACC,MAAM,EAAC,CAAR;YAAWC,IAAI,EAAEN;UAAjB,CAAf,CAApB;QACH,CAFD,MAEO;UACHJ,GAAG,CAACc,IAAJ,CAASP,IAAI,CAACC,SAAL,CAAe;YAACC,MAAM,EAAE;UAAT,CAAf,CAAT;QACH;MACJ,CAND;IAOH;EACJ,CAbD;AAcH,CAfD;;AAiBAM,MAAM,CAACC,OAAP,GAAiBlB,OAAjB"},"metadata":{},"sourceType":"script"}